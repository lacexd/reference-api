/// <reference types="node" />
import { Request, FinalizedRequest, Result, HTTPResponse, ServerReq, ServerRes, ParsedFilterParam, ParsedSortParam, makeDocument, ErrorOrErrorArray, FinalizedSupportedOperators } from "../types";
import Query from "../types/Query/Query";
import ResourceTypeRegistry from "../ResourceTypeRegistry";
import Document, { DocumentData } from "../types/Document";
import Resource from "../types/Resource";
import ResourceIdentifier from "../types/ResourceIdentifier";
import { TransformMode } from "../steps/make-transform-fn";
import { IncomingMessage, ServerResponse } from "http";
import CreateQuery from "../types/Query/CreateQuery";
import FindQuery from "../types/Query/FindQuery";
import UpdateQuery from "../types/Query/UpdateQuery";
import DeleteQuery from "../types/Query/DeleteQuery";
import AddToRelationshipQuery from "../types/Query/AddToRelationshipQuery";
import RemoveFromRelationshipQuery from "../types/Query/RemoveFromRelationshipQuery";
export { CreateQuery, FindQuery, UpdateQuery, DeleteQuery, AddToRelationshipQuery, RemoveFromRelationshipQuery, IncomingMessage, ServerResponse };
export declare type APIControllerOpts = {
    filterParser?: customParamParser<ParsedFilterParam>;
    sortParser?: customParamParser<ParsedSortParam>;
};
export declare type customParamParser<T> = (supportedOperators: FinalizedSupportedOperators, rawQuery: string | undefined, parsedParams: object) => T | undefined;
export declare type QueryFactory = (opts: QueryBuildingContext) => Query | Promise<Query>;
export declare type ResultFactory = (opts: ResultBuildingContext, customQueryFactory?: QueryFactory) => Result | Promise<Result>;
export declare type QueryBuildingContext = {
    request: FinalizedRequest;
    serverReq: ServerReq;
    serverRes: ServerRes;
    transformDocument: (doc: Document, mode: TransformMode) => Promise<Document>;
    setTypePaths: (it: (Resource | ResourceIdentifier)[], useInputData: boolean, requiredThroughType?: string) => Promise<void>;
    registry: ResourceTypeRegistry;
    makeDocument: makeDocument;
    makeQuery: QueryFactory;
};
export declare type ResultBuildingContext = QueryBuildingContext;
export declare type QueryTransformNoReq = {
    (first: Query): Query;
};
export declare type QueryTransformWithReq = {
    (first: ServerReq, second: Query): Query;
};
export declare type RequestOpts = {
    queryTransform?: QueryTransformNoReq | QueryTransformWithReq;
    queryFactory?: QueryFactory;
    resultFactory?: ResultFactory;
};
export declare type FinalizedOperatorsByType = {
    filter: FinalizedSupportedOperators;
    sort: FinalizedSupportedOperators;
};
export default class APIController {
    private registry;
    private filterParamParser;
    private sortParamParser;
    private supportedOperatorsByAdapter;
    constructor(registry: ResourceTypeRegistry, opts?: APIControllerOpts);
    protected makeDoc: (data: DocumentData) => Document;
    protected finalizeRequest(request: Request): Promise<FinalizedRequest>;
    private getFinalizedSupportedOperators(adapter);
    makeQuery(opts: QueryBuildingContext): Promise<CreateQuery | FindQuery | DeleteQuery | UpdateQuery | AddToRelationshipQuery | RemoveFromRelationshipQuery>;
    makeResult(opts: ResultBuildingContext, customQueryFactory?: QueryFactory): Promise<Result>;
    handle: (request: Request, serverReq: IncomingMessage, serverRes: ServerResponse, opts?: RequestOpts) => Promise<HTTPResponse>;
    static responseFromError(errors: ErrorOrErrorArray, requestAccepts: any): Promise<HTTPResponse>;
    static responseFromResult(result: Result, reqAccepts?: string, allow406?: boolean): Promise<HTTPResponse>;
    static supportedExt: ReadonlyArray<string>;
}
export declare function defaultFilterParamParser(filterOps: FinalizedSupportedOperators, rawQuery: string | undefined): {
    type: "FieldExpression";
    operator: string;
    args: any[];
}[] | undefined;
export declare function defaultSortParamParser(sortOps: FinalizedSupportedOperators, rawQuery: string | undefined): ({
    field: string;
    direction: "ASC" | "DESC";
} | {
    expression: ({
        operator: "or";
        args: ((any & {
            type: "FieldExpression";
        }) | ({
            operator: "and";
            args: ((any & {
                type: "FieldExpression";
            }) | (any & {
                type: "FieldExpression";
            }) | ({
                operator: "eq" | "neq" | "ne";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, any];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: "in" | "nin";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, string[] | number[]];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: "lt" | "gt" | "lte" | "gte";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, string | number];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: string;
                args: any[];
            } & {
                type: "FieldExpression";
            }))[];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: "eq" | "neq" | "ne";
            args: [{
                    type: "Identifier";
                    value: string;
                }, any];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: "in" | "nin";
            args: [{
                    type: "Identifier";
                    value: string;
                }, string[] | number[]];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: "lt" | "gt" | "lte" | "gte";
            args: [{
                    type: "Identifier";
                    value: string;
                }, string | number];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: string;
            args: any[];
        } & {
            type: "FieldExpression";
        }))[];
    } & {
        type: "FieldExpression";
    }) | ({
        operator: "and";
        args: (({
            operator: "or";
            args: ((any & {
                type: "FieldExpression";
            }) | (any & {
                type: "FieldExpression";
            }) | ({
                operator: "eq" | "neq" | "ne";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, any];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: "in" | "nin";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, string[] | number[]];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: "lt" | "gt" | "lte" | "gte";
                args: [{
                        type: "Identifier";
                        value: string;
                    }, string | number];
            } & {
                type: "FieldExpression";
            }) | ({
                operator: string;
                args: any[];
            } & {
                type: "FieldExpression";
            }))[];
        } & {
            type: "FieldExpression";
        }) | (any & {
            type: "FieldExpression";
        }) | ({
            operator: "eq" | "neq" | "ne";
            args: [{
                    type: "Identifier";
                    value: string;
                }, any];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: "in" | "nin";
            args: [{
                    type: "Identifier";
                    value: string;
                }, string[] | number[]];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: "lt" | "gt" | "lte" | "gte";
            args: [{
                    type: "Identifier";
                    value: string;
                }, string | number];
        } & {
            type: "FieldExpression";
        }) | ({
            operator: string;
            args: any[];
        } & {
            type: "FieldExpression";
        }))[];
    } & {
        type: "FieldExpression";
    }) | ({
        operator: "eq" | "neq" | "ne";
        args: [{
                type: "Identifier";
                value: string;
            }, any];
    } & {
        type: "FieldExpression";
    }) | ({
        operator: "in" | "nin";
        args: [{
                type: "Identifier";
                value: string;
            }, string[] | number[]];
    } & {
        type: "FieldExpression";
    }) | ({
        operator: "lt" | "gt" | "lte" | "gte";
        args: [{
                type: "Identifier";
                value: string;
            }, string | number];
    } & {
        type: "FieldExpression";
    }) | ({
        operator: string;
        args: any[];
    } & {
        type: "FieldExpression";
    });
    direction: "ASC" | "DESC";
})[] | undefined;
